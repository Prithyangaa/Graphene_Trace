@model List<GrapheneTrace.Model.Alert>

@{
    ViewData["Title"] = "System Alerts";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

<style>
    .gt-page { background: #f5f7fb; min-height: 100vh; padding: 2rem 0; }
    .alert-card {
        background: #fff; border-radius: 14px; padding: 1.2rem 1.5rem;
        border: 1px solid #e2e8f0; box-shadow: 0 4px 12px rgba(0,0,0,0.04);
        margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;
    }
    .alert-left { display: flex; gap: 1rem; align-items: center; }
    .alert-icon { font-size: 1.6rem; color: #334155; }
    .alert-title { font-weight: 600; font-size: 1rem; color: #1e293b; }
    .alert-sub { color: #64748b; font-size: 0.85rem; }
    .severity-badge { padding: 4px 10px; font-size: 0.75rem; border-radius: 8px; text-transform: uppercase; }
    .critical { background: #fee2e2; color: #b91c1c; }
    .high { background: #ffedd5; color: #c2410c; }
    .medium { background: #fef9c3; color: #854d0e; }
    .low { background: #dcfce7; color: #166534; }
    .btn-small { font-size: 0.75rem; padding: 3px 10px; border-radius: 6px; border: 1px solid #cbd5e1; background: #fff; }
    .time-ago { font-size: 0.8rem; color: #94a3b8; }
</style>

<div class="gt-page">
    <div class="container">

        <h3 class="mb-4">System Alerts</h3>

        @foreach (var alert in Model)
        {
            string sevClass = alert.Severity.ToLower() switch
            {
                "critical" => "critical",
                "high" => "high",
                "medium" => "medium",
                _ => "low"
            };

            <div class="alert-card">
                <div class="alert-left">
                    <i class="bi bi-exclamation-triangle alert-icon"></i>

                    <div>
                        <div class="alert-title">@alert.AlertType</div>
                        <div class="alert-sub">Patient ID: @alert.PatientId</div>
                    </div>
                </div>

                <div>
                    <span class="time-ago">@TimeAgo(alert.CreatedAt)</span>
                    <span class="severity-badge @sevClass">@alert.Severity</span>
                </div>
            </div>
        }
    </div>
</div>

@functions {
    public string TimeAgo(DateTime date)
    {
        var ts = DateTime.UtcNow - date;

        if (ts.TotalMinutes < 1) return "just now";
        if (ts.TotalMinutes < 60) return $"{(int)ts.TotalMinutes} min ago";
        if (ts.TotalHours < 24) return $"{(int)ts.TotalHours} hours ago";
        return $"{(int)ts.TotalDays} days ago";
    }
}

